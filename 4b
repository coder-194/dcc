4. alt

Sure! Here's an **all-in-one guide** to setting up a **complete Jenkins CI/CD pipeline** with **SonarQube integration**, using **Maven**, **unit tests**, **integration tests**, **quality gates**, and **deployment**. This includes everything: Docker commands, Jenkins setup, credentials, and a full working `Jenkinsfile`.

---

# âœ… **Complete Jenkins CI/CD Pipeline with SonarQube Integration**

---

## ğŸ§± Prerequisites

* Docker & Docker Compose installed
* Jenkins installed (or run via Docker)
* GitHub repo with Maven project
* Internet access for downloading plugins

---

## ğŸ³ Step 1: Run SonarQube via Docker

```bash
docker run -d --name sonar -p 9000:9000 sonarqube:lts-community
```

* Access SonarQube UI: [http://localhost:9000](http://localhost:9000)
* Default login: `admin / admin`

### ğŸ” Generate SonarQube Token

1. Login â†’ My Account â†’ **Security** tab â†’ **Generate Token**
2. Copy token (e.g., `abc123sonartoken`) for later use in Jenkins

---

## âš™ï¸ Step 2: Install & Configure Jenkins with SonarQube

### ğŸ§© Install Jenkins Plugins

Go to **Jenkins Dashboard** â†’ **Manage Jenkins** â†’ **Manage Plugins**
Install:

* SonarQube Scanner
* Pipeline
* Git
* Maven Integration

---

### ğŸ”§ Configure Tools in Jenkins

Go to: **Manage Jenkins â†’ Global Tool Configuration**

#### â¤ Maven

* Click â€œAdd Mavenâ€
* Name: `Maven_3`
* Auto install: âœ…

#### â¤ SonarQube Scanner

* Click â€œAdd SonarQube Scannerâ€
* Name: `SonarScanner`
* Auto install: âœ…

---

### ğŸ” Configure SonarQube Server

**Manage Jenkins â†’ Configure System**

* Scroll to **SonarQube Servers**

  * Name: `SonarQube`
  * Server URL: `http://localhost:9000`
  * Add token as credentials:

    * Type: **Secret text**
    * ID: `sonar-token-id`
    * Secret: *(paste token)*

---

## ğŸ“ Step 3: Create Jenkins Pipeline Job

1. **Dashboard â†’ New Item**
2. Name: `My-CI-Pipeline`
3. Type: `Pipeline`
4. Click OK

---

## âœï¸ Step 4: Jenkinsfile (All-in-One CI/CD Script)

Paste the following under **Pipeline â†’ Pipeline Script**:

```groovy
pipeline {
  agent any

  tools {
    maven 'Maven_3'
  }

  environment {
    SONARQUBE_URL = 'http://localhost:9000'
    SONARQUBE_SERVER = 'SonarQube'
    SONAR_TOKEN = credentials('sonar-token-id') // Jenkins credential ID
  }

  stages {

    stage('Checkout') {
      steps {
        git branch: 'main', url: 'https://github.com/your-repo/sample-project.git' // Replace with your repo
      }
    }

    stage('Build') {
      steps {
        sh 'mvn clean package'
      }
    }

    stage('Unit Tests') {
      steps {
        sh 'mvn test'
      }
    }

    stage('SonarQube Analysis') {
      steps {
        withSonarQubeEnv(SONARQUBE_SERVER) {
          sh """
            mvn sonar:sonar \
              -Dsonar.projectKey=sample-project \
              -Dsonar.host.url=${SONARQUBE_URL} \
              -Dsonar.login=${SONAR_TOKEN}
          """
        }
      }
    }

    stage('Quality Gate') {
      steps {
        timeout(time: 1, unit: 'MINUTES') {
          waitForQualityGate abortPipeline: true
        }
      }
    }

    stage('Integration Tests') {
      steps {
        sh 'mvn verify'
      }
    }

    stage('Deploy') {
      steps {
        sh 'mvn deploy'
      }
    }
  }
}
```

---

## â–¶ï¸ Step 5: Run Your Pipeline

1. Click **"Build Now"**
2. Monitor Console Output

   * Check for:

     * âœ… Maven build success
     * âœ… SonarQube analysis
     * âœ… Quality Gate approval
     * âœ… Integration & deploy steps
3. Go to [http://localhost:9000](http://localhost:9000) to view project metrics

---

## âœ… Final Outcome

* Full CI/CD pipeline using Jenkins
* SonarQube performs static code analysis
* Fails pipeline if quality gate fails
* Runs unit and integration tests
* Deploys Maven project

---

## ğŸ›¡ï¸ Optional: Use Docker Compose for Jenkins + SonarQube

Hereâ€™s a quick `docker-compose.yml` for Jenkins + SonarQube (optional):

```yaml
version: '3'

services:
  jenkins:
    image: jenkins/jenkins:lts
    ports:
      - 8080:8080
    volumes:
      - jenkins_home:/var/jenkins_home

  sonarqube:
    image: sonarqube:lts-community
    ports:
      - 9000:9000
    environment:
      - sonar.web.javaAdditionalOpts=-server -Xmx512m -Xms128m

volumes:
  jenkins_home:
```

---

## ğŸ“Œ Final Tips

* Always commit your `Jenkinsfile` to the repo (`git add Jenkinsfile`)
* Use branches (`dev`, `main`) to separate dev & prod pipelines
* Configure email or Slack notifications for build status

---

Let me know if you want:

* A Dockerized Maven project template
* A sample GitHub repo to test this on
* How to integrate with GitHub webhooks or Slack alerts
